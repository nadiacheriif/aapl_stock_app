<!DOCTYPE html>
<html lang="en">
<head>
    <title>Stock Prediction Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: Arial, sans-serif; }
        .card { margin-bottom: 20px; border-radius: 10px; }
        .nav-tabs .nav-link { color: #495057; }
        .nav-tabs .nav-link.active { background-color: #007bff; color: white; }
        .prediction-header { color: #dc3545; }
        .table th { background-color: #007bff; color: white; }
    </style>
</head>
<body class="container mt-4">
    <h1 class="text-center mb-4">Stock Prediction Dashboard ({{ selected_ticker }})</h1>
    <p class="text-muted text-center">Data updates daily. GRU model retrains quarterly (Jan, Apr, Jul, Oct).</p>

    {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <div class="card">
        <div class="card-header">
            <h3>Stock Selector</h3>
        </div>
        <div class="card-body">
            <form method="post">
                <select name="ticker" class="form-select mb-3">
                    <option value="AAPL" {% if selected_ticker == 'AAPL' %}selected{% endif %}>AAPL</option>
                    <!-- Add more stocks here in the future -->
                </select>
                <button type="submit" class="btn btn-primary">Select Stock</button>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3>Historical Close Price Trend</h3>
        </div>
        <div class="card-body">
            <ul class="nav nav-tabs">
                <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#plot-1M">1 Month</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#plot-6M">6 Months</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#plot-1Y">1 Year</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#plot-5Y">5 Years</a></li>
            </ul>
            <div class="tab-content mt-3">
                <div class="tab-pane fade show active" id="plot-1M">
                    <img src="data:image/png;base64,{{ historical_plot['1M'] or '' }}" alt="1M Plot" class="img-fluid">
                </div>
                <div class="tab-pane fade" id="plot-6M">
                    <img src="data:image/png;base64,{{ historical_plot['6M'] or '' }}" alt="6M Plot" class="img-fluid">
                </div>
                <div class="tab-pane fade" id="plot-1Y">
                    <img src="data:image/png;base64,{{ historical_plot['1Y'] or '' }}" alt="1Y Plot" class="img-fluid">
                </div>
                <div class="tab-pane fade" id="plot-5Y">
                    <img src="data:image/png;base64,{{ historical_plot['5Y'] or '' }}" alt="5Y Plot" class="img-fluid">
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3>Model Performance Metrics</h3>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr><th>Model</th><th>MAE</th><th>RMSE</th><th>MAPE</th></tr>
                </thead>
                <tbody>
                    {% for row in results %}
                    <tr><td>{{ row.Model }}</td><td>{{ row.MAE }}</td><td>{{ row.RMSE }}</td><td>{{ row.MAPE }}</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3>Recent Data (Last 10 Days)</h3>
        </div>
        <div class="card-body">
            {{ df_tail | safe }}
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3>Get Predictions (GRU Model)</h3>
        </div>
        <div class="card-body">
            <form method="post">
                <input type="hidden" name="ticker" value="{{ selected_ticker }}">
                <div class="mb-3">
                    <label class="form-label">Forecast Term:</label>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="term" value="short" {% if term == 'short' %}checked{% endif %}>
                        <label class="form-check-label">Short-Term (Day, Week)</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="term" value="long" {% if term == 'long' %}checked{% endif %}>
                        <label class="form-check-label">Long-Term (Month, Quarter, Year)</label>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="horizon" class="form-label">Prediction Horizon:</label>
                    <select name="horizon" id="horizon" class="form-select">
                        {% if term == 'short' %}
                        <option value="day" {% if horizon == 'day' %}selected{% endif %}>Next Day (1 day)</option>
                        <option value="week" {% if horizon == 'week' %}selected{% endif %}>Next Week (5 days)</option>
                        {% else %}
                        <option value="month" {% if horizon == 'month' %}selected{% endif %}>Next Month (20 days)</option>
                        <option value="quarter" {% if horizon == 'quarter' %}selected{% endif %}>Next Quarter (63 days)</option>
                        <option value="year" {% if horizon == 'year' %}selected{% endif %}>Next Year (252 days)</option>
                        {% endif %}
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Predict</button>
            </form>
        </div>
    </div>

    {% if pred_table %}
    <div class="card">
        <div class="card-header prediction-header">
            <h3>Prediction Results</h3>
        </div>
        <div class="card-body">
            {% if overall_pct %}
            <p><strong>Overall Change:</strong> {{ overall_pct }}</p>
            {% endif %}
            {{ pred_table | safe }}
            {% if prediction_plot %}
            <img src="data:image/png;base64,{{ prediction_plot }}" alt="Prediction Plot" class="img-fluid">
            {% endif %}
        </div>
    </div>
    {% endif %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>